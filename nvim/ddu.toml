[[plugins]]
repo = 'Shougo/ddu.vim'
depends = ['denops.vim']
on_source = 'denops.vim'
lua_source = '''
vim.fn["ddu#custom#patch_global"]({
	ui = "ff",
	uiOptions = {
		filer = {
			toggle = true
		}
	},
	uiParams = {
		ff = {
			prompt = "> ",
			filterSplitDirection = "floating",
			split = "floating",
			floatingBorder = "rounded",
			floatingTitlePos = "center",
			previewFloating = true,
			previewFloatingBorder = "rounded",
			previewFloatingTitle = { { "Preview", "String" } },
			previewFloatingTitlePos = "center",
			highlights = {
				floatingCursorLine = "DduCursor",
				preview = "DduPreview"
			},
			previewWindowOptions = { { "&signcolumn", "no" }, { "&wrap", 0 }, { "&number", 0 }, { "&foldenable", 0 } }
		},
		filer = {
			split = "floating",
			floatingBorder = "rounded",
			previewFloating = true,
			previewFloatingBorder = "rounded",
			sortTreesFirst = true
		}
	},
	filterParams = {
		matcher_fzf = {
			highlightMatched = "String"
		},
		matcher_substring = {
			highlightMatched = "String"
		},
		matcher_kensaku = {
			highlightMatched = "String"
		},
		converter_file_icon = {
			source = "nvim-web-devicons"
		},
	},
	kindOptions = {
		action = {
			defaultAction = "do",
			quit = "true"
		},
		file = {
			defaultAction = "open"
		},
		floaterm = {
			defaultAction = "open"
		},
		lsp = {
			defaultAction = "open"
		},
		ui_select = {
			defaultAction = "select"
		},
		command_history = {
			defaultAction = "execute"
		},
		help = {
			defaultAction = "open"
		},
		dein_update = {
			defaultAction = "viewDiff"
		},
		channel = {
			defaultAction = "open"
		},
		["ai-review-request"] = {
			defaultAction = "open"
		},
		["ai-review-log"] = {
			defaultAction = "resume"
		},
		window = {
			defaultAction = "open"
		},
		tab = {
			defaultAction = "open"
		}
	},
	actionOptions = {
		echo = {
			quit = false
		},
		echoDiff = {
			quit = false
		}
	},
	sourceOptions = {
		rg = {
			matchers = { "converter_display_word", "matcher_fzf" }
		},
		file_rec = {
			matchers = { "matcher_fzf" },
			converters = { "converter_file_icon" }
		},
		file_external = {
			matchers = { "matcher_fzf" },
			converters = { "converter_file_icon" }
		},
		channel = {
			columns = { "filename" }
		},
		dummy = {
			matchers = {}
		},
		dein_update = {
			matchers = { "matcher_dein_update" }
		},
		_ = {
			matchers = { "matcher_fzf" },
			sorters = { "sorter_fzf" }
		}
	}
})

-- layout

local function set_size()
	-- 関数外部のwinColを参照して、columns / 8を代入する
	Columns = vim.api.nvim_get_option("columns")
	Lines = vim.api.nvim_get_option("lines")
	WinCol = math.floor(Columns / 8)
	WinRow = math.floor(Lines / 8)
	WinWidth = math.floor(Columns - (Columns / 4))
	WinHeight = math.floor(Lines - (Lines / 4))
end
local function set_ff_layout()
	-- ┌────────────────────────────────┐
	-- │                                │
	-- │                                │
	-- │        source                  │
	-- │                                │
	-- │                                │
	-- │                                │
	-- └────────────────────────────────┘
	vim.fn["ddu#custom#patch_local"]('default', {
		uiParams = {
			ff = {
				winCol = WinCol,
				winRow = WinRow,
				winWidth = WinWidth,
				winHeight = WinHeight
			}
		}
	})

	-- ┌────────────────┐┌────────────────┐
	-- │                ││                │
	-- │                ││                │
	-- │                ││                │
	-- │  source        ││                │
	-- │                ││                │
	-- │                ││   preview      │
	-- │                ││                │
	-- │                ││                │
	-- │                ││                │
	-- └────────────────┘│                │
	-- ┌────────────────┐│                │
	-- │   filter       ││                │
	-- └────────────────┘└────────────────┘
	vim.fn["ddu#custom#patch_local"]('ui_filter_preview_layout', {
		uiParams = {
			ff = {
				startFilter = true,
				filterFloatingPosition = 'bottom',
				autoAction = { name = 'preview' },
				startAutoAction = true,
				winCol = WinCol,
				winRow = WinRow,
				winWidth = math.floor(WinWidth / 2),
				winHeight = WinHeight,
				previewCol = WinCol + math.floor(WinWidth / 2) + 2,
				previewRow = WinRow + WinHeight + 5,
				previewWidth = math.floor(WinWidth / 2),
				previewHeight = WinHeight + 3,
			}
		}
	})

	-- ┌────────────────┐
	-- │                │
	-- │   preview      │
	-- │                │
	-- └────────────────┘
	-- ┌────────────────┐
	-- │   source       │
	-- │                │
	-- └────────────────┘
	-- ┌────────────────┐
	-- │   filter       │
	-- └────────────────┘
	vim.fn["ddu#custom#patch_local"]('ui_filter_preview_horizontal_layout', {
		uiParams = {
			ff = {
				startFilter = true,
				filterFloatingPosition = 'bottom',
				autoAction = { name = 'preview' },
				startAutoAction = true,
				previewSplit = 'horizontal',
				winCol = WinCol,
				winRow = math.floor(Lines / 2),
				winWidth = WinWidth,
				winHeight = math.floor(WinHeight / 2),
				previewCol = WinCol,
				previewRow = 0,
				previewWidth = WinWidth,
				previewHeight = math.floor(WinHeight / 2),
			}
		}
	})

	-- ┌────────────────┐
	-- │                │
	-- │   source       │
	-- │                │
	-- └────────────────┘
	-- ┌────────────────┐
	-- │   filter       │
	-- └────────────────┘
	vim.fn["ddu#custom#patch_local"]('ui_filter_layout', {
		uiParams = {
			ff = {
				startFilter = true,
				filterFloatingPosition = 'bottom',
				winCol = WinCol,
				winWidth = WinWidth,
				winRow = WinRow,
				winHeight = WinHeight,
			}
		}
	})

	-- ┌────────────────┐┌────────────────┐
	-- │                ││                │
	-- │                ││                │
	-- │                ││                │
	-- │  source        ││   preview      │
	-- │                ││                │
	-- │                ││                │
	-- │                ││                │
	-- │                ││                │
	-- └────────────────┘└────────────────┘
	vim.fn["ddu#custom#patch_local"]('ui_preview_layout', {
		uiParams = {
			ff = {
				autoAction = { name = 'preview' },
				startAutoAction = true,
				previewSplit = 'vertical',
				winCol = WinCol,
				winWidth = math.floor(WinWidth / 2),
				winRow = WinRow,
				winHeight = WinHeight,
				previewCol = WinCol + math.floor(WinWidth / 2) + 2,
				previewWidth = math.floor(WinWidth / 2),
				previewRow = WinRow,
				previewHeight = WinHeight,
			}
		}
	})
end

local function set_filer_layout()
	-- ┌────────────────────────────────┐
	-- │                                │
	-- │                                │
	-- │        source                  │
	-- │                                │
	-- │                                │
	-- │                                │
	-- └────────────────────────────────┘
	vim.fn["ddu#custom#patch_local"]('default', {
		uiParams = {
			filer = {
				winCol = WinCol,
				winRow = WinRow,
				winWidth = WinWidth,
				winHeight = WinHeight,
			}
		}
	})

	-- ┌────────────────┐┌────────────────┐
	-- │                ││                │
	-- │                ││                │
	-- │                ││                │
	-- │  source        ││   preview      │
	-- │                ││                │
	-- │                ││                │
	-- │                ││                │
	-- │                ││                │
	-- └────────────────┘└────────────────┘
	vim.fn["ddu#custom#patch_local"]('ui_filer_preview_layout', {
		uiParams = {
			filer = {
				autoAction = { name = 'preview' },
				startAutoAction = true,
				previewSplit = 'vertical',
				winCol = WinCol,
				winWidth = math.floor(WinWidth / 2),
				winRow = WinRow,
				winHeight = WinHeight,
				previewCol = WinCol + math.floor(WinWidth / 2) + 2,
				previewWidth = math.floor(WinWidth / 2),
				previewRow = WinRow,
				previewHeight = WinHeight,
			}
		}
	})

	-- ┌────────────────┐
	-- │                │
	-- │   preview      │
	-- │                │
	-- └────────────────┘
	-- ┌────────────────┐
	-- │                │
	-- │   source       │
	-- │                │
	-- └────────────────┘
	vim.fn["ddu#custom#patch_local"]('ui_filer_preview_horizontal_layout', {
		uiParams = {
			filer = {
				autoAction = { name = 'preview' },
				startAutoAction = true,
				previewSplit = 'horizontal',
				winCol = WinCol,
				winWidth = WinWidth,
				winRow = WinRow + math.floor(WinHeight / 2),
				winHeight = math.floor(WinHeight / 2),
				-- previewCol = WinCol,
				previewWidth = WinWidth,
				-- previewRow = WinRow + math.floor(WinHeight / 2),
				previewHeight = math.floor(WinHeight / 2),
			}
		}
	})
end

local function layout()
	set_size()
	set_ff_layout()
	set_filer_layout()
end

layout()

vim.api.nvim_create_autocmd("VimResized", {
	pattern = "*",
	callback = function()
		layout()
	end
})

-- custom action

vim.fn["ddu#custom#action"]('kind', 'file', 'setcdo', function(args)
	local qflist = {}
	for _, item in ipairs(args["items"]) do
		local qf = {}
		qf["text"] = item["word"]
		local action = item["action"]
		qf["lnum"] = action["lineNr"]
		qf["bufnr"] = action["bufNr"]
		table.insert(qflist, qf)
	end
	vim.fn.setqflist(qflist, ' ')
	local cmd = vim.fn.input(":cdo ", "normal ")
	print(cmd)
	vim.fn.execute("cdo " .. cmd)
	return 0
end)

vim.fn["ddu#custom#action"]('kind', 'file', 'grep', function(args)
	local path = args["items"][1]["action"]["path"]
	local directory = vim.fn.isdirectory(path) and path or vim.fn.fnamemodify(path, ":h")
	vim.fn["ddu#start"]({
		name = args["options"]["name"],
		push = true,
		sources = {
			{
				name = "rg",
				params = {
					path = directory,
					input = vim.fn.input("Pattern: ")
				}
			}
		}
	})
	return 0
end)

vim.fn["ddu#custom#action"]('source', 'file', 'file_rec', function(args)
	local items = args["items"]
	local action = items[1]["action"]
	vim.fn["ddu#start"]({
		sources = {
			{ name = "file_rec", options = { path = action["path"] } }
		}
	})
	return 0
end)

vim.fn["ddu#custom#action"]('kind', 'lsp', 'setBreakPoint', function(args)
	for _, item in ipairs(args["items"]) do
		local action = item["action"]
		local lnum = action["lnum"]
		vim.fn.execute(lnum)
		require("dap").set_breakpoint()
	end
	return 0
end)

vim.fn["ddu#custom#action"]('source', 'buffer', 'delete', function(args)
	for _, item in ipairs(args["items"]) do
		local action = item["action"]
		local bufNr = action["bufNr"]
		vim.fn.execute("bdelete " .. bufNr)
	end
	return 0
end)

vim.fn["ddu#custom#action"]('source', 'register', 'trimCRLF', function(args)
	for _, item in ipairs(args["items"]) do
		local regName = item["word"][0]
		local action = item["action"]
		-- local regType = action["regType"]
		local regText = action["text"]
		vim.fn.setreg(regName, vim.fn.substitute(regText, "\r", "", "g"))
	end
	return 1
end)

vim.fn["ddu#custom#action"]('ui', 'ff', 'kensaku', function(args)
	local sources = args["options"]["sources"]
	for _, source in ipairs(sources) do
		if source["name"] ~= "dummy" then
			local options = source["options"]
			local converters = nil
			if options ~= nil then
				converters = options["converters"]
			end
			source["options"] = {
				matchers = { "matcher_kensaku" },
				sorters = {},
				converters = converters,
			}
		end
	end
	vim.fn["ddu#ui#ff#do_action"]('updateOptions', {
		uiParams = {
			ff = {
				filterFloatingTitle = { { "日本語検索", "LightBlue" } },
				filterFloatingTitlePos = "center",
			}
		},
		sources = sources
	})
	return 2
end)

-- ddu key mapping

vim.keymap.set('n', '[ddu]', '<Nop>')
vim.keymap.set('n', '<Space>u', '[ddu]', { remap = true })

-- telescopeのREADMEの順っぽく設定

-- file周り
vim.keymap.set('n', '[ddu]f', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Filter", "FloatBorder" } },
			}
		},
		sources = {
			{ name = "file_rec", params = {} }
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]g', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Files", "FloatBorder" }, { "Git", "FloatBorder" } },
			}
		},
		sources = {
			{
				name = "file_external",
				params = { cmd = { "git", "ls-files" } }
			}
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]r', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				ignoreEmpty = false,
				autoResize = false,
				floatingTitle = { { "Live Grep", "String" } }
			}
		},
		sources = {
			{
				name = "rg",
				options = { matchers = {}, volatile = true }
			}
		}
	})
end, { remap = true })

-- vim周り
vim.keymap.set('n', '[ddu]b', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Buffers", "Blue" } },
			}
		},
		sources = {
			{ name = "buffer" }
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]c', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Command History", "FloatBorder" } },
				autoAction = {}
			}
		},
		sources = {
			{ name = "command_history" }
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]h', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Help", "FloatBorder" } },
			}
		},
		sources = {
			{ name = "help" }
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]q', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "QuickFix", "FloatBorder" } },
			}
		},
		sources = {
			{ name = "qf", params = { isSubset = true, format = "%p|%t" } }
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]j', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_horizontal_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "JumpList", "FloatBorder" } },
			}
		},
		sources = {
			{ name = "jumplist" }
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]t', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Tab", "FloatBorder" } },
				autoAction = {
					name = "preview",
					params = { border = { "+", "-", "+", "|" } }
				}
			}
		},
		sources = {
			{ name = "tab", params = { format = "tab|%n|%T:%w" } }
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]w', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Window", "FloatBorder" } },
				autoAction = {
					name = "preview",
				}
			}
		},
		sources = {
			{
				name = "window",
				options = { matchers = { "matcher_regex", "matcher_fzf" } },
				params = { format = "tab:%tn:%T:%w:%wi" }
			}
		},
		filterParams = {
			matcher_regex = {
				regex = "^(?!.*ddu-ff).*$"
			}
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]L', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_horizontal_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Line", "FloatBorder" } },
				previewWindowOptions = { { "&signcolumn", "no" }, { "&wrap", 0 }, { "&number", 0 },
					{ "&relativenumber", 1 } }
			}
		},
		sources = {
			{ name = "line" }
		}
	})
end, { remap = true })

-- lsp
vim.keymap.set('n', '[ddu]lr', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Lsp References", "FloatBorder" } },
			}
		},
		sources = {
			{ name = "lsp_references" }
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]ld', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Lsp Definition", "FloatBorder" } },
			}
		},
		sources = {
			{
				name = "dummy",
				options = {
					converters = {
						{ name = "converter_highlight", params = { hl_group = "Red" } }
					}
				},
				params = { display = ">>Definition<<" }
			},
			{ name = "lsp_definition", params = { method = "textDocument/definition" } },
			{
				name = "dummy",
				options = {
					converters = {
						{ name = "converter_highlight", params = { hl_group = "Blue" } }
					}
				},
				params = { display = ">>typeDefinition<<" }
			},
			{ name = "lsp_definition", params = { method = "textDocument/typeDefinition" } },
			{
				name = "dummy",
				options = {
					converters = {
						{ name = "converter_highlight", params = { hl_group = "Yellow" } }
					}
				},
				params = { display = ">>declaration<<" }
			},
			{ name = "lsp_definition", params = { method = "textDocument/declaration" } },
			{
				name = "dummy",
				options = {
					converters = {
						{ name = "converter_highlight", params = { hl_group = "Green" } }
					}
				},
				params = { display = ">>Implementation<<" }
			},
			{ name = "lsp_definition", params = { method = "textDocument/implementation" } },
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]ls', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_horizontal_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Lsp Symbol", "FloatBorder" } },
				displayTree = true,
			}
		},
		sources = {
			{ name = "dummy",              params = { display = "documentSymbol" } },
			{
				name = "lsp_documentSymbol",
				options = {
					converters = {
						{
							name = "converter_lsp_symbol",
							params = {
								iconMap = {
									["File"] = "",
									["Module"] = "",
									["Namespace"] = "",
									["Package"] = "",
									["Class"] = "",
									["Method"] = "",
									["Property"] = "",
									["Field"] = "",
									["Constructor"] = "",
									["Enum"] = "",
									["Interface"] = "",
									["Function"] = "",
									["Variable"] = "",
									["Constant"] = "",
									["String"] = "",
									["Number"] = "",
									["Boolean"] = "",
									["Array"] = "",
									["Object"] = "",
									["Key"] = "",
									["Null"] = "",
									["EnumMember"] = "",
									["Struct"] = "",
									["Event"] = "",
									["Operator"] = "",
									["TypeParameter"] = "",
								}
							}
						}
					}
				}
			},
			{ name = "dummy",              params = { display = "workspaceSymbol" } },
			{ name = "lsp_workspaceSymbol" },
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]lh', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Lsp Hierarchy", "FloatBorder" } },
				displayTree = true,
				startFilter = false
			}
		},
		sources = {
			{ name = "dummy",             params = { display = "incomingCalls" } },
			{ name = "lsp_callHierarchy", params = { method = "callHierarchy/incomingCalls" } },
			{ name = "dummy",             params = { display = "outgoingCalls" } },
			{ name = "lsp_callHierarchy", params = { method = "callHierarchy/outgoingCalls" } },
		}
	})
end, { remap = true })

-- 他プラグインとの連携
vim.keymap.set('n', '[ddu]T', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_horizontal_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Floaterm", "FloatBorder" } },
				startFilter = false,
			}
		},
		sources = {
			{ name = "floaterm" },
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]d', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_layout",
		uiParams = {
			ff = {
				floatingTitle = { { "Dein", "Black" } },
				autoAction = {}
			}
		},
		sources = {
			{ name = "dein" },
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]v<CR>', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		sources = {
			{ name = "channel_rec" },
		}
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]ve<CR>', function()
	vim.fn["ddu#start"]({
		ui = "filer",
		uiParams = {
			filer = {
				displayRoot = false,
			},
		},
		sources = {
			{ name = "dummy", params = { display = "未読チャンネル" } },
			{ name = "channel_rec", params = { type = "unread" } },
			{ name = "dummy", params = { display = "チャンネルツリー" } },
			{
				name = "channel",
				options = {
					columns = { "channel" }
				}
			},
		},
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]vu<CR>', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		name = "ui_filter_preview_layout",
		sources = {
			{ name = "channel_rec", params = { type = "unread" } },
		}
	})
end, { remap = true })

-- filer
vim.keymap.set('n', '[ddu]e', function()
	vim.fn["ddu#start"]({
		ui = "filer",
		uiParams = {
			filer = {
				split = "floating",
				splitDirection = "topleft",
				previewFloating = true
			}
		},
		name = "ui_filer_preview_horizontal_layout",
		resume = true,
		sources = { { name = "file" } },
		sourceOptions = {
			_ = {
				columns = { "icon_filename" },
				converters = { "converter_file_git_status" }
			}
		},
	})
end, { remap = true })
vim.keymap.set('n', '[ddu]E', function()
	vim.fn["ddu#start"]({
		ui = "ff",
		uiParams = {
			ff = {
				startFilter = true,
				floatingTitle = { { "File", "FloatBorder" }, { "Browser", "Directory" } },
			}
		},
		sources = {
			{
				name = "file",
				options = {
					columns = { "icon_filename" },
					converters = { "converter_file_git_status", "converter_file_info" }
				}
			}
		},
	})
end, { remap = true })
'''

[[plugins]]
repo = 'Shougo/ddu-ui-ff'
on_source = 'ddu.vim'
# hooks_file = 'nvim/ddu-ui-ff.vim'
lua_source = '''
vim.api.nvim_create_autocmd("FileType", {
	pattern = "ddu-ff",
	callback = function()
		vim.opt_local.cursorline = true
		vim.opt_local.signcolumn = 'yes'

		vim.keymap.set('n', '<CR>', function()
			vim.fn["ddu#ui#ff#do_action"]('itemAction')
		end, { buffer = true })
		vim.keymap.set('n', 't', function()
			vim.fn["ddu#ui#ff#do_action"]('itemAction', { params = { command = "tabnew" } })
		end, { buffer = true })
		vim.keymap.set('n', 'o', function()
			vim.fn["ddu#ui#ff#do_action"]('itemAction', { params = { command = "split" } })
		end, { buffer = true })
		vim.keymap.set('n', 'v', function()
			vim.fn["ddu#ui#ff#do_action"]('itemAction', { params = { command = "vsplit" } })
		end, { buffer = true })
		vim.keymap.set('n', '<C-j>', function()
			vim.fn["ddu#ui#ff#do_action"]('kensaku')
		end, { buffer = true })
		vim.keymap.set('n', 'a', function()
			vim.fn["ddu#ui#ff#do_action"]('chooseAction')
		end, { buffer = true })
		vim.keymap.set('n', 's', function()
			vim.fn["ddu#ui#ff#do_action"]('toggleSelectItem')
		end, { buffer = true })
		vim.keymap.set('n', 'i', function()
			vim.fn["ddu#ui#ff#do_action"]('openFilterWindow')
		end, { buffer = true })
		vim.keymap.set('n', 'c', function()
			vim.fn["ddu#ui#ff#do_action"]('closeFilterWindow')
		end, { buffer = true })
		vim.keymap.set('n', 'p', function()
			vim.fn["ddu#ui#ff#do_action"]('preview')
		end, { buffer = true })
		vim.keymap.set('n', 'e', function()
			vim.fn["ddu#ui#ff#do_action"]('expandItem', { mode = "toggle" })
		end, { buffer = true })
		vim.keymap.set('n', 'q', function()
			vim.fn["ddu#ui#ff#do_action"]('quit')
		end, { buffer = true })
		vim.keymap.set('n', '-', function()
			local sourceName = vim.fn["ddu#ui#get_item"]()["__sourceName"]
			if sourceName == "file" then
				vim.fn["ddu#ui#ff#do_action"]('itemAction', {
					name = "narrow",
					params = { path = ".." }
				})
			end
		end, { buffer = true })

		vim.api.nvim_create_autocmd({ "CursorMoved" }, {
			buffer = 0,
			callback = function()
				vim.fn.sign_unplace('', { id = 100 })
				vim.fn.sign_define("cursor", { text = ">>", texthl = "Constant" })
				vim.fn.sign_place(100, '', "cursor", vim.fn.bufnr('%'), { lnum = vim.fn.line('.') })
			end
		})
	end
})
vim.api.nvim_create_autocmd("FileType", {
	pattern = "ddu-ff-filter",
	callback = function()
		vim.keymap.set('n', '<CR>', function()
			vim.fn["ddu#ui#ff#do_action"]('itemAction')
		end, { buffer = true })
		vim.keymap.set('n', 'q', function()
			vim.fn["ddu#ui#ff#do_action"]('quit')
		end, { buffer = true })
		vim.keymap.set('i', '<CR>', function()
			if vim.fn["ddu#ui#get_item"]()["__sourceName"] == "file" and
				vim.fn["ddu#ui#get_item"]()["action"]["isDirectory"] == true then
				vim.fn["ddu#ui#ff#do_action"]('itemAction', { name = "narrow" })
			else
				vim.fn["ddu#ui#ff#do_action"]('itemAction')
			end
		end, { buffer = true })
		vim.keymap.set('i', '<C-p>', function()
			vim.fn["ddu#ui#ff#do_action"]('preview')
		end, { buffer = true })
		vim.keymap.set('i', '<C-t>', function()
			vim.fn["ddu#ui#ff#do_action"]('itemAction', { params = { command = "tabnew" } })
		end, { buffer = true })
		vim.keymap.set('i', '<C-o>', function()
			vim.fn["ddu#ui#ff#do_action"]('itemAction', { params = { command = "split" } })
		end, { buffer = true })
		vim.keymap.set('i', '<C-v>', function()
			vim.fn["ddu#ui#ff#do_action"]('itemAction', { params = { command = "vsplit" } })
		end, { buffer = true })
		vim.keymap.set('i', '<C-n>', function()
			vim.fn["ddu#ui#ff#do_action"]("cursorNext")
		end, { buffer = true })
		vim.keymap.set('i', '<C-p>', function()
			vim.fn["ddu#ui#ff#do_action"]("cursorPrevious")
		end, { buffer = true })
		vim.keymap.set('i', '<C-s>', function()
			vim.fn["ddu#ui#ff#do_action"]("toggleSelectItem")
		end, { buffer = true })
		vim.keymap.set('i', '<C-a>', function()
			vim.fn["ddu#ui#ff#do_action"]("toggleAllItems")
		end, { buffer = true })
		vim.keymap.set('i', '<C-l>', '<Esc><Cmd>call ddu#ui#ff#do_action("leaveFilterWindow")<CR>', { buffer = true })
		vim.keymap.set('i', '<C-j>', '<Esc><Cmd>call ddu#ui#ff#do_action("kensaku")<CR>', { buffer = true })
		vim.keymap.set('i', '<C-q>', function()
			vim.fn["ddu#ui#ff#do_action"]("quit")
		end, { buffer = true })
	end
})
'''

[[plugins]]
repo = 'Shougo/ddu-ui-filer'
on_source = 'ddu.vim'
lua_source = '''
vim.api.nvim_create_autocmd("FileType", {
	pattern = "ddu-filer",
	callback = function()
		vim.keymap.set('n', '<CR>', function()
			local item = vim.fn["ddu#ui#get_item"]()
			if item["isTree"] ~= nil and item["isTree"] then
				vim.fn["ddu#ui#do_action"]('expandItem', { mode = 'toggle' })
			else
				vim.fn["ddu#ui#do_action"]('itemAction')
			end
		end, { buffer = true })
		vim.keymap.set('n', 'e', function()
			vim.fn["ddu#ui#do_action"]('expandItem', { mode = 'toggle' })
		end, { buffer = true })
		vim.keymap.set('n', 'p', function()
			vim.fn["ddu#ui#do_action"]('togglePreview')
		end, { buffer = true })
		vim.keymap.set('n', 's', function()
			vim.fn["ddu#ui#do_action"]('toggleSelectItem')
		end, { buffer = true })
		vim.keymap.set('n', 'o', function()
			vim.fn["ddu#ui#do_action"]('itemAction', { name = 'open', params = { command = 'split' } })
		end, { buffer = true })
		vim.keymap.set('n', 'v', function()
			vim.fn["ddu#ui#do_action"]('itemAction', { name = 'open', params = { command = 'vsplit' } })
		end, { buffer = true })
		vim.keymap.set('n', 't', function()
			vim.fn["ddu#ui#do_action"]('itemAction', { name = 'open', params = { command = 'tabnew' } })
		end, { buffer = true })
		vim.keymap.set('n', 'a', function()
			vim.fn["ddu#ui#do_action"]('chooseAction')
		end, { buffer = true })
		vim.keymap.set('n', '%', function()
			vim.fn["ddu#ui#do_action"]('itemAction', { name = 'newFile' })
		end, { buffer = true })
		vim.keymap.set('n', 'd', function()
			vim.fn["ddu#ui#do_action"]('itemAction', { name = 'newDirectory' })
		end, { buffer = true })
		vim.keymap.set('n', 'R', function()
			vim.fn["ddu#ui#do_action"]('itemAction', { name = 'rename' })
		end, { buffer = true })
		vim.keymap.set('n', 'q', function()
			vim.fn["ddu#ui#do_action"]('quit')
		end, { buffer = true })
	end
})
'''

# 補完Source

[[plugins]]
repo = 'Shougo/ddu-source-file'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-source-file_rec'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-source-file_old'
on_source = 'ddu.vim'

[[plugins]]
repo = 'flow6852/ddu-source-qf'
on_source = 'ddu.vim'

[[plugins]]
repo = 'shun/ddu-source-rg'
on_source = 'ddu.vim'

[[plugins]]
repo = 'shun/ddu-source-buffer'
on_source = 'ddu.vim'

[[plugins]]
repo = 'matsui54/ddu-vim-ui-select'
on_source = 'ddu.vim'

[[plugins]]
repo = 'matsui54/ddu-source-command_history'
on_source = 'ddu.vim'

[[plugins]]
repo = 'uga-rosa/ddu-source-lsp'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-source-line'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-source-jumplist'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-source-register'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-source-tab'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-source-floaterm'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-source-window'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-source-treesitter'
on_source = 'ddu.vim'

[[plugins]]
repo = 'matsui54/ddu-source-dein_update'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-source-dummy'
on_source = 'ddu.vim'

[[plugins]]
repo = 'matsui54/ddu-source-help'
on_source = 'ddu.vim'

[[plugins]]
repo = 'matsui54/ddu-source-file_external'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-source-action'
on_source = 'ddu.vim'

[[plugins]]
repo = 'yuki-yano/ddu-source-nvim-notify'
on_source = 'ddu.vim'

# 補完Filter
[[plugins]]
repo = 'Shougo/ddu-filter-matcher_substring'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-filter-matcher_regex'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-filter-converter_highlight'
on_source = 'ddu.vim'

[[plugins]]
repo = 'yuki-yano/ddu-filter-fzf'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Milly/ddu-filter-kensaku'
depends = ['kensaku.vim']
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-filter-converter_display_word'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-filter-converter_file_icon'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-filter-converter_file_info'
on_source = 'ddu.vim'

[[plugins]]
repo = 'kamecha/ddu-filter-converter_file_git_status'
on_source = 'ddu.vim'

# 補完Kind
[[plugins]]
repo = 'Shougo/ddu-kind-file'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-kind-word'
on_source = 'ddu.vim'

# カラム
[[plugins]]
repo = 'Shougo/ddu-column-filename'
on_source = 'ddu.vim'

# icon
[[plugins]]
repo = 'ryota2357/ddu-column-icon_filename'
on_source = 'ddu.vim'

# command
[[plugins]]
repo = 'Shougo/ddu-commands.vim'
on_source = 'ddu.vim'
