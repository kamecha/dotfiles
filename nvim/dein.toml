# plugin manager
[[plugins]]
repo = 'Shougo/dein.vim'

# profile vim startup time
[[plugins]]
repo = 'dstein64/vim-startuptime'

# LSP
[[plugins]]
repo = 'neovim/nvim-lspconfig'
lua_add = '''
vim.keymap.set('n', '<space>e', vim.diagnostic.open_float)
vim.keymap.set('n', '[d', vim.diagnostic.goto_prev)
vim.keymap.set('n', ']d', vim.diagnostic.goto_next)
vim.keymap.set('n', '<space>q', vim.diagnostic.setloclist)
-- Use LspAttach autocommand to only map the following keys
-- after the language server attaches to the current buffer
vim.api.nvim_create_autocmd('LspAttach', {
  group = vim.api.nvim_create_augroup('UserLspConfig', {}),
  callback = function(ev)
    -- Enable completion triggered by <c-x><c-o>
    -- vim.bo[ev.buf].omnifunc = 'v:lua.vim.lsp.omnifunc'

    -- Buffer local mappings.
    -- See `:help vim.lsp.*` for documentation on any of the below functions
    local opts = { buffer = ev.buf }
    vim.keymap.set('n', 'gD', vim.lsp.buf.declaration, opts)
    vim.keymap.set('n', 'gd', vim.lsp.buf.definition, opts)
    vim.keymap.set('n', 'K', vim.lsp.buf.hover, opts)
    vim.keymap.set('n', 'gi', vim.lsp.buf.implementation, opts)
    vim.keymap.set('n', '<C-k>', vim.lsp.buf.signature_help, opts)
    vim.keymap.set('n', '<space>wa', vim.lsp.buf.add_workspace_folder, opts)
    vim.keymap.set('n', '<space>wr', vim.lsp.buf.remove_workspace_folder, opts)
    vim.keymap.set('n', '<space>wl', function()
      print(vim.inspect(vim.lsp.buf.list_workspace_folders()))
    end, opts)
    vim.keymap.set('n', '<space>D', vim.lsp.buf.type_definition, opts)
    vim.keymap.set('n', '<space>rn', vim.lsp.buf.rename, opts)
    vim.keymap.set('n', '<space>ca', vim.lsp.buf.code_action, opts)
    vim.keymap.set('n', 'gr', vim.lsp.buf.references, opts)
    vim.keymap.set('n', '<space>f', function()
      vim.lsp.buf.format { async = true }
    end, opts)
  end,
})
'''
lua_source = '''
vim.lsp.handlers["textDocument/hover"] = vim.lsp.with(
	vim.lsp.handlers.hover, {
	   -- Use a sharp border with `FloatBorder` highlights
		border = "single",
	   -- add the title in hover float window
		title = "hover"
	}
)
vim.lsp.handlers["textDocument/signatureHelp"] = vim.lsp.with(
	vim.lsp.handlers.signature_help, {
	-- Use a sharp border with `FloatBorder` highlights
	border = "single"
	}
)
'''

[[plugins]]
repo = 'williamboman/mason.nvim'
lua_source = '''
require('mason').setup()
'''

[[plugins]]
repo = 'williamboman/mason-lspconfig.nvim'
depends = ['nvim-lspconfig', 'mason.nvim']
lua_source = '''
local nvim_lsp = require("lspconfig")
local mason_lspconfig = require('mason-lspconfig')
local navic = require("nvim-navic")
local capabilities = vim.lsp.protocol.make_client_capabilities()
capabilities.textDocument.completion.completionItem.snippetSupport = true
mason_lspconfig.setup_handlers({ function(server_name)
	local opts = {
		on_attach = function(client, bufnr)
			if client.server_capabilities.documentSymbolProvider then
				navic.attach(client, bufnr)
			end
		end,
		capabilities = capabilities
	}
	if server_name == "tsserver" then
		opts.root_dir = nvim_lsp.util.root_pattern("package.json", "tsconfig.json")
	elseif server_name == "denols" then
		opts.root_dir = nvim_lsp.util.root_pattern("deps.ts", "deno.json")
	elseif server_name == "lua_ls" then
		opts.settings = {
			Lua = {
				diagnostics = { globals = { "vim" } },
			}
		}
	end
	nvim_lsp[server_name].setup(opts)
end })
'''

[[plugins]]
repo = 'SmiteshP/nvim-navic'

# LSPのラッパー
[[plugins]]
repo = 'jose-elias-alvarez/null-ls.nvim'
lua_source = '''
-- settting for null-ls to use textlint
local null_ls = require("null-ls")
null_ls.setup({
	sources = {
		null_ls.builtins.diagnostics.textlint.with({
			filetypes = { "markdown", "text", "tex" },
			condition = function(utils)
				return utils.root_has_file({
					".textlintrc",
					".textlintrc.json",
					".textlintrc.yaml",
					".textlintrc.yml",
					".textlintrc.js",
				})
			end,
		})
	},
})
'''

# Debugger
[[plugins]]
repo = 'mfussenegger/nvim-dap'
lua_add = '''
vim.keymap.set('n', '<F5>', function() require('dap').continue() end)
vim.keymap.set('n', '<F10>', function() require('dap').step_over() end)
vim.keymap.set('n', '<F11>', function() require('dap').step_into() end)
vim.keymap.set('n', '<F12>', function() require('dap').step_out() end)
vim.keymap.set('n', '<Leader>b', function() require('dap').toggle_breakpoint() end)
vim.keymap.set('n', '<Leader>B', function() require('dap').set_breakpoint() end)
vim.keymap.set('n', '<Leader>lp', function() require('dap').set_breakpoint(nil, nil, vim.fn.input('Log point message: ')) end)
vim.keymap.set('n', '<Leader>dr', function() require('dap').repl.open() end)
vim.keymap.set('n', '<Leader>dl', function() require('dap').run_last() end)
vim.keymap.set({'n', 'v'}, '<Leader>dh', function()
	require('dap.ui.widgets').hover()
end)
vim.keymap.set({'n', 'v'}, '<Leader>dp', function()
	require('dap.ui.widgets').preview()
end)
vim.keymap.set('n', '<Leader>df', function()
	local widgets = require('dap.ui.widgets')
	widgets.centered_float(widgets.frames)
end)
vim.keymap.set('n', '<Leader>ds', function()
	local widgets = require('dap.ui.widgets')
	widgets.centered_float(widgets.scopes)
end)
'''
lua_source = '''
local dap = require('dap')

dap.adapters = {
	codelldb = {
		type = 'server',
		port = "${port}",
		executable = {
			command = vim.fn.stdpath('data') .. '/mason/packages/codelldb/extension/adapter/codelldb',
			args = { "--port", "${port}" }
		}
	},
}

dap.configurations = {
	cpp = {
		{
			name = 'Launch file',
			type = 'codelldb',
			request = 'launch',
			program = function()
				return vim.fn.input('Path to executable: ', vim.fn.getcwd() .. '/a.out', 'file')
			end,
			cwd = '${workspaceFolder}',
			stopOnEntry = false,
		}
	}
}

'''

[[plugins]]
repo = 'rcarriga/nvim-dap-ui'
lua_source = '''
require('dapui').setup()
'''

# null-lsで使うらしい
[[plugins]]
repo = 'nvim-lua/plenary.nvim'

# インストールのUI
[[plugins]]
repo = 'j-hui/fidget.nvim'
rev = 'legacy'
lua_add = '''
vim.api.nvim_create_autocmd('LspAttach', {
	once = true,
	callback = function()
		require('fidget').setup({
			text = {
				spinner = 'moon',
			},
		})
	end,
})
'''
lua_source = '''
require('fidget').setup({})
'''

[[plugins]]
repo = 'folke/neodev.nvim'
lua_source = '''
require("neodev").setup({})
'''

# deno
[[plugins]]
repo = 'vim-denops/denops.vim'
on_event = 'CursorHold'

# ターミナルを良い感じにする
[[plugins]]
repo = 'akinsho/toggleterm.nvim'
rev = '*'

[[plugins]]
repo = 'voldikss/vim-floaterm'
lua_add = '''
vim.g.floaterm_width = 0.9
vim.g.floaterm_height = 0.9
vim.keymap.set('n', '<F8>', ':FloatermNew<CR>', { silent = true })
vim.keymap.set('n', '<F9>', ':FloatermToggle<CR>', { silent = true })
vim.keymap.set('t', '<F9>', '<C-\\><C-n>:FloatermToggle<CR>', { silent = true })
'''

# AI補完
[[plugins]]
repo = 'github/copilot.vim'
lua_add = '''
vim.keymap.set('i', '<C-l>', 'copilot#Accept("<CR>")', { silent = true, script = true, expr = true, replace_keycodes = false })
vim.g.copilot_no_tab_map = true
'''

[[plugins]]
repo = 'nvim-telescope/telescope.nvim'
depends = ['plenary.nvim']
merged = '0'
lua_source = '''
require('telescope').setup({})
require('telescope').load_extension('noice')
'''

[[plugins]]
repo = 'nvim-telescope/telescope-file-browser.nvim'
depends = ['telescope.nvim']
merged = '0'
lua_source = '''
require('telescope').load_extension('file_browser')
'''

# help日本語
[[plugins]]
repo = 'vim-jp/vimdoc-ja'
hook_source = 'set helplang=ja,en'

# 翻訳
[[plugins]]
repo = 'skanehira/denops-translate.vim'

# gccでコメントアウト
[[plugins]]
repo = 'numToStr/Comment.nvim'
lua_source = '''
require('Comment').setup()
'''

# 部分編集
[[plugins]]
repo = 'thinca/vim-partedit'

# font周りの設定(nerd fontとか)
[[plugins]]
repo = 'nvim-tree/nvim-web-devicons'
rev = 'nerd-v2-compat'

[[plugins]]
repo = 'utilyre/barbecue.nvim'
depends = [ 'SmiteshP/nvim-navic', 'nvim-tree/nvim-web-devicons' ]
lua_source = '''
require('barbecue').setup({
	separator = "  ",
	icons_enabled = true,
	icons = {
		default = "",
		symlink = "",
		git = "",
		folder = "",
		["folder-open"] = "",
	},
})
'''

[[plugins]]
repo = 'nvim-lualine/lualine.nvim'
lua_add = '''
vim.opt.laststatus = 3
'''
lua_source = '''
local navic = require("nvim-navic")
navic.setup({
	highlight = true,
	separator = "  ",
})

local lsp_names = function()
	local clients = {}
	for _, client in ipairs(vim.lsp.get_active_clients { bufnr = 0 }) do
		if client.name == 'null-ls' then
			local sources = {}
			for _, source in ipairs(require('null-ls.sources').get_available(vim.bo.filetype)) do
				table.insert(sources, source.name)
			end
			table.insert(clients, 'null-ls(' .. table.concat(sources, ', ') .. ')')
		else
			table.insert(clients, client.name)
		end
	end
	local denops_status = vim.fn['denops#server#status']()
	if denops_status ~= '' then
		table.insert(clients, "D:" .. denops_status)
	end
	return ' ' .. table.concat(clients, ', ')
end

require('lualine').setup({
	options = {
		globalstatus = true,
		disabled_filetypes = {
			winbar = {
				"netrw",
			}
		}
	},
	sections = {
		lualine_c = {
			{
				"filename",
			}
		},
		lualine_x = {
			lsp_names
		},
		lualine_y = {
			'encoding',
			'fileformat',
			'filetype',
		},
		lualine_z = {
			{
				"progress",
			},
			{
				"location"
			}
		}
	},
})
'''

# タブライン
[[plugins]]
repo = 'nanozuki/tabby.nvim'
lua_add = '''
vim.opt.showtabline = 2
'''
lua_source = '''
local theme = {
	fill = 'TabLineFill',
	head = 'TabLine',
	current_tab = 'TabLineSel',
	tab = 'TabLine',
	win = 'TabLine',
	tail = 'TabLine',
}

require('tabby.tabline').set(function(line)
	return {
		{
			{ '  ', hl = theme.head },
			line.sep('', theme.head, theme.fill),
		},
		line.tabs().foreach(function(tab)
			if tab.is_current() then
				return {
					line.sep('', theme.fill, theme.current_tab),
				tab.is_current() and '' or '',
					tab.number(),
					tab.name(),
					tab.close_btn(''),
					line.sep('', theme.current_tab, theme.fill),
					hl = theme.current_tab,
					margin = ' ',
				}
			else
				return {
					line.sep('', theme.fill, theme.tab),
				tab.is_current() and '' or '',
					tab.number(),
					tab.name(),
					tab.close_btn(''),
					line.sep('', theme.tab, theme.fill),
					hl = theme.tab,
					margin = ' ',
				}
			end
		end),
		line.spacer(),
		line.wins_in_tab(line.api.get_current_tab()).foreach(function(win)
			return {
				line.sep('', theme.win, theme.fill),
				win.is_current() and '' or '',
				win.buf_name(),
				line.sep('', theme.fill, theme.win),
				hl = theme.win,
				margin = ' ',
			}
		end),
		{
			line.sep('', theme.tail, theme.fill),
			{ '  ', hl = theme.tail },
		},
		hl = theme.fill,
	}
end, {
		tab_name = {
			name_fallback = function(tabid)
				return ""
			end
		}
})
'''

#  popup等の補助情報の表示
[[plugins]]
repo = 'matsui54/denops-popup-preview.vim'
depends = 'denops.vim'
lua_add = '''
vim.opt.completeopt:remove('preview')
'''
lua_source = '''
vim.fn['popup_preview#enable']()
'''

# git branch
[[plugins]]
repo = 'itchyny/vim-gitbranch'

# カッコ補完
[[plugins]]
repo = 'cohama/lexima.vim'

# surround
[[plugins]]
repo = 'tpope/vim-surround'

# BadApple
[[plugins]]
repo = 'skanehira/badapple.vim'

# markdownのプレビュー
[[plugins]]
repo = 'iamcco/markdown-preview.nvim'
on_ft = ['markdown', 'pandoc.markdown', 'rmd']
build = 'cd app && yarn install'

# colorのプレビュー
[[plugins]]
repo = 'gko/vim-coloresque'

# color scheme
[[plugins]]
repo = 'EdenEast/nightfox.nvim'

[[plugins]]
repo = 'sainnhe/edge'
lua_add = '''
if vim.fn.has('termguicolors') == 1 then
	vim.opt.termguicolors = true
end
vim.g.edge_style = 'aura'
vim.g.edge_better_performance = 1
'''

# UI
[[plugins]]
repo = 'folke/noice.nvim'
depends = ['nui.nvim']
lua_source = '''
-- settting for nocie.vim
require('noice').setup {
	cmdline = {
		enabled = true,
		view = "cmdline_popup",
		format = {
			cmdline = { icon = ">" },
			search_down = { icon = "🔍⌄" },
			search_up = { icon = "🔍⌃" },
			filter = { icon = "$" },
			lua = { icon = "☾" },
			help = { icon = "?" },
		},
	},
	popupmenu = {
		enabled = true,
		view = "pum",
	},
	lsp = {
		progress = {
			enabled = false
		}
	}
}
'''

# UI Component Library for Neovim
[[plugins]]
repo = 'MunifTanjim/nui.nvim'

# notification manager for Neovim
[[plugins]]
repo = 'rcarriga/nvim-notify'
lua_source = '''
require('notify').setup({
	render = "minimal",
	timeout = 1000,
	})
vim.notify = require('notify')
'''

[[plugins]]
repo = 'tyru/open-browser.vim'

[[plugins]]
repo = 'kamecha/traqVimPractice'
[plugins.ftplugin]
traqvim = '''
setlocal noswapfile
nnoremap <buffer><silent> r
			\ :TraqReload<CR>
nnoremap <buffer><silent> o
			\ :TraqMessageOpen<CR>
'''
traqvim-message = '''
nnoremap <buffer><silent> s
			\ :TraqMessageSend<CR>
'''

# help
[[plugins]]
repo = 'LeafCage/vimhelpgenerator'

# git
[[plugins]]
repo = 'lambdalisue/gina.vim'
lua_add = '''
vim.keymap.set('n', '[Gina]', '<Nop>')
vim.keymap.set('n', '<space>g', '[Gina]', { remap = true })
vim.keymap.set('n', '[Gina]s', ':Gina status<CR>', { remap = true, silent = true })
vim.keymap.set('n', '[Gina]c', ':Gina commit<CR>', { remap = true, silent = true })
vim.keymap.set('n', '[Gina]l', ':Gina log --graph --all<CR>', { remap = true, silent = true })
vim.keymap.set('n', '[Gina]b', ':Gina branch --all<CR>', { remap = true, silent = true })
'''
[plugins.ftplugin]
gina-log = '''
setlocal cursorline
'''

[[plugins]]
repo = 'lewis6991/gitsigns.nvim'
lua_source = '''
require('gitsigns').setup()
'''

# GitHub
[[plugins]]
repo = 'skanehira/denops-gh.vim'

# QuickFixを一括置換
[[plugins]]
repo = 'thinca/vim-qfreplace'

# QuickFixを編集
[[plugins]]
repo = 'itchyny/vim-qfedit'

# skkの辞書
[[plugins]]
repo = 'skk-dev/dict'

# 日本語検索をローマ字で
[[plugins]]
repo = 'lambdalisue/kensaku.vim'

[[plugins]]
repo = 'lambdalisue/mr.vim'

# <C-a> <C-x>を使い易くする
[[plugins]]
repo = 'monaqa/dial.nvim'
lua_add = '''
vim.keymap.set('n', '<C-a>', '<Plug>(dial-increment)')
vim.keymap.set('n', '<C-x>', '<Plug>(dial-decrement)')
vim.keymap.set('n', 'g<C-a>', 'g<Plug>(dial-increment)', { remap = true })
vim.keymap.set('n', 'g<C-x>', 'g<Plug>(dial-decrement)', { remap = true })
vim.keymap.set('v', '<C-a>', '<Plug>(dial-increment)')
vim.keymap.set('v', '<C-x>', '<Plug>(dial-decrement)')
vim.keymap.set('v', 'g<C-a>', 'g<Plug>(dial-increment)', { remap = true })
vim.keymap.set('v', 'g<C-x>', 'g<Plug>(dial-decrement)', { remap = true })
'''
lua_source = '''
local augend = require("dial.augend")
require("dial.config").augends:register_group {
	default = {
		augend.integer.alias.decimal,
		augend.integer.alias.hex,
		augend.constant.alias.bool,
		augend.constant.alias.ja_weekday,
		augend.constant.alias.ja_weekday_full,
	}
}
'''

# 簡易実行
[[plugins]]
repo = 'thinca/vim-quickrun'
